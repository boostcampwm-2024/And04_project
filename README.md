<div align="right">
부스트캠프 웹・모바일 9기 멤버십 Android : And04_project
</div>

# 🍀 Nature Album 🍀

주변의 생물을 촬영하고 식별하여 나만의 생물 도감을 만들고, 생물 지도를 친구들과 공유할 수 있는 앱 서비스

<img src="https://github.com/user-attachments/assets/5dca1733-a3dc-4a2f-bca3-094cd8bb2010" alt="Nature Album 배너 이미지" width="100%">

<br>

## ⭐ 프로젝트 소개

- 주변 생물을 촬영해 도감에 등록할 수 있습니다.
- 생물 도감 뿐만아니라 생물 지도에도 등록됩니다.
- 비회원으로 네트워크 없이 어디서든 생물을 촬영해 나만의 생물 도감을 만들어보세요~!
- 추가로 로그인을 하면 친구들의 생물 지도를 함께 볼 수 있답니다 😉 함께 즐겨보시는 것도 추천드립니다.

<br>

## ✨ 서비스 기능 소개

- 📸 생물 촬영 : 카메라로 주변의 생물 촬영
- 🖼️ 생물 도감 등록 : 라벨링하여 도감에 저장 및 도감 확인
- 🗺️ 생물 지도 확인 : 생물 도감의 위치 별로 표시되는 지도 확인
- 🤼 친구의 생물 지도 보기 : 로그인 하여 친구 추가한 친구들의 생물 지도 함께 보기

<br>

---
## ✨ 상세 기능 요약

![04  구조](https://github.com/user-attachments/assets/646c79fa-180d-490f-b212-cfe8989c06b1)

<br>

## ✨ 상세 기능 (GIF) 

<details>
<summary>도감 등록</summary>
<div>
  
|카메라 권한|촬영 & AI 라벨링|
|:---:|:---:|
|![permigif](https://github.com/user-attachments/assets/fc55df84-efea-47c3-9647-b2f10c959f26)|![aigif](https://github.com/user-attachments/assets/c121c79a-6e66-4e44-95f7-d5d593b913e4)|

</div>
</details>


<details>
<summary>도감 보기</summary>
<div>
  
|도감 상세보기|도감 이미지 앨범에 저장|도감 이미지 삭제|
|:---:|:---:|:---:|
|![도감 상세보기](https://github.com/user-attachments/assets/90936815-39ac-4d46-94af-3750b341b689)|![앨범에 저장](https://github.com/user-attachments/assets/4a7e4da9-6430-45ec-8382-916c204c6422)|![도감 삭제](https://github.com/user-attachments/assets/1c17ac07-33c7-4532-b094-9b209b764361)|

</div>
</details>

<details>
<summary>지도</summary>
<div>
  
|내 지도 보기|친구 지도 보기|네트워크 연결 확인|
|:---:|:---:|:---:|
|![내 지도 보기](https://github.com/user-attachments/assets/b3ecf90c-7074-4efa-b088-96fd5b36f6da)|![친구 지도 보기](https://github.com/user-attachments/assets/3ee94f22-c420-4434-a7b3-74b1b881bf2c)|![네트워크 연결 확인](https://github.com/user-attachments/assets/76fc1329-e8b0-450a-91fe-9f19c6d1f0dd)|

</div>
</details>

<details>
<summary>마이페이지 로그인 및 네트워크 연결 처리</summary>
<div>
  
|로그인|네트워크 마이페이지|동기화|
|:---:|:---:|:---:|
|![로그인](https://github.com/user-attachments/assets/05163740-b303-44d7-a317-79b7c47793ad)|![네트워크 마이페이지](https://github.com/user-attachments/assets/98a818fc-141f-485d-ae65-10befbf2d9c0)|![동기화](https://github.com/user-attachments/assets/3a37288e-9834-4f98-942f-111981f52a23)|

</div>
</details>

<details>
<summary>마이페이지 친구 기능</summary>
<div>
  
|친구 목록| 친구 검색과 네트워크 대응 | 
|:---:|:---:|
| ![1  친구 목록](https://github.com/user-attachments/assets/a243238b-84c9-454d-9b73-1afe70eafe62) | ![2  친구 검색 네트워크 포함](https://github.com/user-attachments/assets/501fb48d-05e1-44ae-9256-72419a8b786f) |  
| 친구 요청 거절과 수락 | foreground 친구 요청 알림|
|![3-4  친구 요청 거절과 수락](https://github.com/user-attachments/assets/e6cfd780-aeb3-4731-9d3e-a71ef83e5422) | ![3-1  친구 요청 포그라운드](https://github.com/user-attachments/assets/1b7f34de-de9b-42a1-adb3-395fc9082b47)|
 | background 친구 요청 알림 | 앱 종료 상태일 때 친구 요청 알림 |
 | ![3-2  친구 요청 백그라운드](https://github.com/user-attachments/assets/f41f5745-abba-455c-8a93-3eb9ad2642a9) | ![3-3  친구 요청 앱 종료](https://github.com/user-attachments/assets/8587294b-8003-44f2-bb23-bf78ffb6b6d1) | |

</div>
</details>

<br>

---

## 💫 서비스 구조

![04  구조](https://github.com/user-attachments/assets/aa64e72c-2f8b-4f85-921d-544bda283487)

<br>

## ✨ 기술 스택

| *분야* | *기술 스택* |
| --- | --- |
| **OS** | `Android` |
| **Launguage** | `Kotlin` |
| **UI** | `Compose` |
| **Network** | `Retrofit` |
| **Asynchronous** | `Coroutine`, `Flow` |
| **image** | `Coil` |
| **DI** | `Hilt` |
| **Background** | `WorkManager` |
| **Database** | `Room`, `FireStore` |
| **Map** | `Naver Map` |
| **Firebase** | `Firebase Storage`, `Firebase Cloud Messaging`, `Cloud Functions` |
| **AI** | `Gemini`, `Green-Eye` |
| **Tooling** | `Notion`, `Figma`, `Figjam`, `Github`, `Git`, `Zep` |

<br>

---

## 핵심 경험
### 1. 동기화
<img src="https://github.com/user-attachments/assets/c4f57389-85ec-4354-ba8b-dc2de9e684ad" width=400/> <img src="https://github.com/user-attachments/assets/5d9a473f-882e-4c53-a5f7-a725f4f4284e" width=400/>   
동기화는 로그인 상태에서 매일 자정에 WIFI 연결 상태에서만 실행이 됩니다.   
동기화가 필요한 상황은 다음과 같습니다.   
> 1. 비회원으로 사용하다 로그인하는 경우
> 2. 네트워크 없이 사용하여 서버와 로컬의 데이터가 상이한 경우
> 3. 앱을 재설치하거나 앱 데이터를 삭제하여 로컬 데이터가 날아간 경우
> 4. 네트워크가 없는 상태에서 도감을 삭제 또는 추가한 경우

따라서 서버와 로컬의 데이터를 모두 가져와 비교하여 서버에 필요한 데이터, 로컬에 필요한 데이터, 상이한 데이터로 분류한 뒤 저장 및 수정이 이루어지도록 구현하였습니다.   
#### 문제점!   
- 모두 가져와 비교하기 때문에 데이터가 많아지면 그만큼 오래걸리게 됩니다.
- 또한 지금은 `서버에 필요한 데이터`, `로컬에 필요한 데이터`, `상이한 데이터` 세 가지 모두 각각 탐색하여 추출하기 때문에 효율에 대한 문제가 있습니다. 

#### 개선 방안
1. 현재 탐색 방법을 Filter와 none, any 확장 함수를 사용하고 있는데 이는 for문으로 하나씩 탐색하는 방법으로 한 번 탐색할 때마다 O(N)의 시간 복잡도가 소요됩니다.   
따라서 이진 탐색으로 탐색하여 탐색 시간을 줄이는 방법을 사용 >> 다만 현재 데이터 리스트는 각각의 객체 타입으로 이루어져 있어 이를 어떻게 이진 탐색으로 구현할 지 고민이 필요합니다.
2. 서비스의 특성상 서버는 로컬 데이터의 변화를 파악하기 어렵지만 로컬은 서버에 저장 된 데이터를 파악할 수 있습니다. Local DB에 서버 저장 유무에 대한 속성을 추가하여 미등록 된 데이터만 가져와 비교하는 방법으로 시간 단축을 기대할 수 있습니다.
3. 한 번의 탐색으로 `서버에 필요한 데이터`, `로컬에 필요한 데이터`, `상이한 데이터`를 추출, 현재 같은 탐색을 3번 반복하여 서로 다른 데이터를 추출하고 있는데 이를 한 번에 3가지의 데이터를 추출하여 시간 단축을 기대할 수 있습니다.

<br>

### 2. Recomposition 최적화

![63](https://github.com/user-attachments/assets/970c860e-befb-4c64-a69d-005ead29d5b4)

기존 하위 컴포저블이 가진 상태를 호이스팅함으로써 공유하고 재사용 가능한 stateless한 컴포저블로 만들었습니다.

호이스팅된 상태를 하위 컴포저블에게 주기 위해 `by remember`를 사용하여 바로 값에 접근하여 값 자체를 상태를 필요로하는 컴포저블에게 넘겨주었습니다.

<br>

#### 문제점!
하지만 위 이미지처럼 `by remember` 를 통해 값 자체를 넘겨줄 때 상태를 끌어올린 위치까지 전부 리컴포지션이 되는 문제가 발생했습니다.

하지만 반대로 `= remember` 를 사용해 `State` 타입을 넘겨주었을 땐, 실제 상태를 이용하는 컴포저블만 리컴포지션이 발생했습니다.

<br>

#### 원인과 해결 과정
두 선언 방식은 어떤 차이가 있길래 리컴포지션 측면에서 전혀 다른 결과가 발생했는지 알아보기 위해 들어간 내부 코드의 설명에서 정답을 찾을 수 있었습니다.

내부 코드에서는 아래와 같은 설명을 통해 안내하고 있었습니다.

> A mutable value holder where reads to the value property during the execution of a Composable function, the current RecomposeScope will be subscribed to changes of that value.
>
> When the value property is written to and changed, a recomposition of any subscribed RecomposeScopes will be scheduled.


컴포저블 함수가 실행되는 동안 `.value(getValue)` 를 읽으면 현재 실행중인 컴포저블은 해당 상태의 변경사항을 구독(subscribed)한다.

`value` 속성이 작성되고 변경되면 해당 상태를 구독한 컴포지션은 리컴포지션의 대상이된다.

<br>

즉, 상위 컴포저블에서 `by remember` 를 통해 값에 접근할 때는 내부적으로 `getValue` 를 통해 `value` 속성에 접근했기에 리컴포지션이 대상이 되었던 것이고, `= remember`를 사용하여 `State` 타입을 넘겨주었을 때는 `value` 속성에 접근한 것이 아니기에 리컴포지션 대상이 되지 않았던 것이었습니다.

따라서, 상태를 끌어올린 위치의 컴포저블에서는 `= remember` 를 사용하고, 상태를 필요로하는 하위 컴포저블까지 `State` 타입을 넘겨주는 것으로 리컴포지션 최적화를 할 수 있었습니다.

<br>

---

## 📔 문서

[Wiki 바로가기](https://github.com/boostcampwm-2024/and04-Nature-Album/wiki)   

<br>

<img src="https://github.com/user-attachments/assets/2d1fa247-6d4f-43c5-9a9a-baa94b13a03d"/>

<br>

---

## 🧑‍🤝‍🧑 전국구 팀 구성

| <img src="https://avatars.githubusercontent.com/u/113690378?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/87519273?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/95901395?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/113237390?v=4" width="140"> | <img src="https://avatars.githubusercontent.com/u/108558921?v=4" width="140"> |
| :--: | :--: | :--: | :--: | :--: |
| [정유진](https://github.com/yujin45) | [임형준](https://github.com/lh99j) | [김도윤](https://github.com/kimdoyun98) | [노진환](https://github.com/Jinhwan99) | [김정호](https://github.com/kim4152) |
